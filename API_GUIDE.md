# Гид по возможностям Go-CRM API

Этот документ объясняет, что мы можем делать с API Go-CRM, какие есть уровни доступа и ограничения.

## 1. Уровни доступа

В системе Go-CRM есть три типа API, которые мы используем:

| Тип API | Требуется ключ? | Для чего нужен |
|---------|-----------------|----------------|
| **Public API** | Нет | Сбор заявок (лидов) с сайта, список городов и филиалов. |
| **Client API** | Да (`APP_TOKEN`) | Личный кабинет клиента: профиль, свои дети, расписание, оплаты. |
| **Plugin API** | Вебхук URL | Прямая отправка лидов в конкретные воронки. |

---

## 2. Что мы МОЖЕМ делать (Доступно сейчас)

### Сбор данных (Read)
- **Города**: Получение списка всех городов присутствия.
- **Центры**: Список всех филиалов (адреса, телефоны, координаты).
- **Сотрудники**: (В теории) Список персонала. *На текущий момент сервер возвращает 500 ошибку, ждем ответа поддержки.*

### Запись данных (Write)
- **Создание лидов**: Отправка имен, телефонов и комментариев потенциальных клиентов прямо в CRM.
- **Вебхуки**: Отправка заявок через специальные ссылки плагинов.

---

## 3. Что мы СМОЖЕМ делать (После получения `APP_TOKEN`)

Как только поддержка выдаст токен приложения, нам откроются:

### Данные клиентов
- **Профиль**: Информация о текущем пользователе.
- **Клиенты**: Список детей, привязанных к аккаунту.
- **Абонементы**: Информация о купленных и активных абонементах.
- **Занятия**: История посещений и предстоящие уроки.

### Финансы
- **Платежи**: История оплат (только ваши).
- **Долги**: Информация о ваших задолженностях.

### Возможности записи (Write)
Client API позволяет не только читать, но и выполнять действия:
- **Обновление профиля**: Можно изменить ФИО, Email и другие данные.
- **Запись на занятия**: Можно самостоятельно записать ребенка в свободное "окно" в расписании.
- **Оплата**: Формирование ссылки на оплату абонемента через эквайринг.

---

## 4. Ограничения и особенности

- **Лиды (Чтение)**: Публичное API **не позволяет** просматривать список чужих лидов. Мы можем только создавать новые. Даже с `APP_TOKEN` (через Client API) доступа к общей базе лидов нет — этот токен дает доступ только к данными конкретного авторизованного клиента (родителя). Для выгрузки всех лидов всех клиентов требуется доступ уровня "Менеджер".
- **Масштаб данных**: Через Client API вы видите данные **только по себе и своим детям**. Вы **не сможете** увидеть общую сумму оплат всех клиентов клуба или баланс чужих абонементов. Это API "Личного кабинета".
- **Баланс занятий**: Да, API возвращает как общее количество занятий в абонементе (`numberExercise`), так и текущий остаток (`balance`). Это позволяет легко считать статистику использования.
- **Авторизация**: Для Client API используется связка `APP_TOKEN` + номер телефона + SMS-код.
- **База данных**: Сейчас мы храним данные в `planeta_gocrm.db`. Это удобно для локального анализа, но для командной работы данные позже переедут в облако (Supabase).

---

## 5. Полезные советы для анализа
Все данные из базы можно выгрузить в Excel-совместимый формат CSV командой:
```bash
python scripts/export_data.py
```
Файлы появятся в папке `exports/`, их можно открывать в любой программе для работы с таблицами.
